<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>P2P Chat - Secure Communication</title>
  <link rel="stylesheet" href="sign.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

    * {
      font-family: 'Poppins', sans-serif;
    }

    /* Utility classes for the gallery */
    .text-3xl {
      font-size: 1.875rem;
      line-height: 2.25rem;
    }

    .font-semibold {
      font-weight: 600;
    }

    .text-center {
      text-align: center;
    }

    .mx-auto {
      margin-left: auto;
      margin-right: auto;
    }

    .text-sm {
      font-size: 0.875rem;
      line-height: 1.25rem;
    }

    .text-slate-500 {
      color: rgb(100 116 139);
    }

    .mt-2 {
      margin-top: 0.5rem;
    }

    .max-w-lg {
      max-width: 32rem;
    }

    .flex {
      display: flex;
    }

    .items-center {
      align-items: center;
    }

    .gap-6 {
      gap: 1.5rem;
    }

    .h-\[400px\] {
      height: 400px;
    }

    .w-full {
      width: 100%;
    }

    .max-w-5xl {
      max-width: 64rem;
    }

    .mt-10 {
      margin-top: 2.5rem;
    }

    .relative {
      position: relative;
    }

    .group {
      position: relative;
    }

    .flex-grow {
      flex-grow: 1;
    }

    .transition-all {
      transition-property: all;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-duration: 150ms;
    }

    .w-56 {
      width: 14rem;
    }

    .duration-500 {
      transition-duration: 500ms;
    }

    .hover\:w-full:hover {
      width: 100%;
    }

    .h-full {
      height: 100%;
    }

    .object-cover {
      object-fit: cover;
    }

    .object-center {
      object-position: center;
    }

    .object-right {
      object-position: right;
    }

    .absolute {
      position: absolute;
    }

    .inset-0 {
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }

    .flex-col {
      flex-direction: column;
    }

    .justify-end {
      justify-content: flex-end;
    }

    .p-10 {
      padding: 2.5rem;
    }

    .text-white {
      color: rgb(255 255 255);
    }

    .bg-black\/50 {
      background-color: rgb(0 0 0 / 0.5);
    }

    .opacity-0 {
      opacity: 0;
    }

    .group-hover\:opacity-100:group-hover {
      opacity: 1;
    }

    .duration-300 {
      transition-duration: 300ms;
    }

    /* Form styles */
    .hidden {
      display: none;
    }

    .success-message {
      color: green;
      margin-top: 10px;
      padding: 10px;
      background: #f0fff0;
      border: 1px solid green;
      border-radius: 4px;
    }

    .error-message {
      color: red;
      margin-top: 10px;
      padding: 10px;
      background: #fff0f0;
      border: 1px solid red;
      border-radius: 4px;


      /* Modal styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: #fefefe;
        margin: 10% auto;
        padding: 2rem;
        border-radius: 12px;
        width: 90%;
        max-width: 400px;
        position: relative;
      }

      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        position: absolute;
        right: 1rem;
        top: 0.5rem;
      }

      .close:hover {
        color: black;
      }

      /* Form styles */
      .hidden {
        display: none !important;
      }

      .interactive-btn {
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .interactive-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
      }

      .interactive-card {
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .interactive-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .interactive-word {
        transition: all 0.3s ease;
        cursor: pointer;
        display: inline-block;
      }
    }

    /* Hide auth-only links until user logs in */
    .auth-only {
      display: none;
    }

    .auth-visible .auth-only {
      display: inline-block;
    }
  </style>
</head>

<body class="with-bg">
  <header>
    <div class="top-nav">
      <img src="logo.png" alt="P2P Chat Logo" class="logo">
      <nav>
        <a href="index.html">Home</a>
        <a href="tp.html" class="auth-only">Dashboard</a>
        <a href="profile.html" class="auth-only">Profile</a>
        <a href="setting.html" class="auth-only">Settings</a>
        <a href="#" id="logoutLink" class="auth-only">Logout</a>
      </nav>
    </div>
  </header>

  <!-- Animated background layers -->
  <div class="bg-visual">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="blob b4"></div>
    <div class="gradient-overlay"></div>
  </div>

  <section class="hero">
    <h1>Welcome to P2P Chat</h1>
    <p>Connect with anyone, anywhere ‚Äî securely and instantly.</p>
    <button id="signupHeroBtn" class="interactive-btn">Join Now</button>
  </section>

  <section class="promotions">
    <div class="promo-card interactive-card" data-title="Fast Connections"
      data-desc="Experience lightning-fast peer-to-peer communication.">
      <h3>üöÄ Fast Connections</h3>
      <p>Experience lightning-fast peer-to-peer communication.</p>
    </div>
    <div class="promo-card interactive-card" data-title="Secure Messaging"
      data-desc="Your data stays private ‚Äî end-to-end encryption built in.">
      <h3>üîí Secure Messaging</h3>
      <p>Your data stays private ‚Äî end-to-end encryption built in.</p>
    </div>
    <div class="promo-card interactive-card" data-title="Cross Platform"
      data-desc="Use P2P Chat on any device: mobile, desktop, or tablet.">
      <h3>üåê Cross Platform</h3>
      <p>Use P2P Chat on any device: mobile, desktop, or tablet.</p>
    </div>
    <!-- Added promo a2 and a4 -->
    <div id="a2" class="promo-card interactive-card highlight">
      <h3>üí¨ Messenger aggregator in the unified window</h3>
      <p>Bring multiple messaging channels together into a single unified window for seamless workflows.</p>
    </div>
    <div id="a4" class="promo-card interactive-card highlight">
      <h3>üìà Stable communication and effective dialogues</h3>
      <p>Stable communication and effective dialogues for the revenue growth and increased awareness of the company!</p>
    </div>
  </section>

  <!-- Signup Modal -->
  <div class="modal" id="signupModal">
    <div class="modal-content interactive-card">
      <span class="close" id="closeModal">&times;</span>
      <h2>Sign Up</h2>
      <form id="signupForm">
        <input type="text" name="username" placeholder="Username" required>
        <input type="email" name="email" placeholder="Email" required>
        <input type="password" name="password" placeholder="Password" minlength="8" required>
        <div id="modalSignupPasswordHelp" style="margin-top:8px;font-size:13px;color:#666;display:none;"></div>
        <button type="submit" class="signup-btn interactive-btn">Sign Up</button>
      </form>
      <div id="signupMessage"></div>
    </div>
  </div>

  <!-- Promo detail modal (opens when user clicks a promo card) -->
  <div class="modal" id="promoModal" aria-hidden="true">
    <div class="modal-content interactive-card">
      <button class="close" id="closePromo">&times;</button>
      <h2 id="promoTitle">Promo</h2>
      <p id="promoDesc">Details...</p>
    </div>
  </div>

  <div class="container">
    <!-- Signup Form -->
    <div id="signup-form">
      <h2>Create Account</h2>
      <form id="mainSignupForm">
        <input type="text" id="signup-username" name="username" placeholder="Username" required>
        <input type="email" id="signup-email" name="email" placeholder="Email" required>
        <input type="password" id="signup-password" name="password" placeholder="Password (min 8 chars)" minlength="8"
          required>
        <div id="mainSignupPasswordHelp" style="margin-top:8px;font-size:13px;color:#666;display:none;"></div>
        <button type="submit" id="signup-btn">Register</button>
      </form>
      <div id="mainSignupMessage"></div>
      <div class="social-buttons">
        <button class="google-btn social-btn" id="google-signup" title="Sign up with Google">
          <!-- Google SVG Icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
            style="vertical-align:middle;margin-right:8px;">
            <path
              d="M21.35 11.1h-9.18v2.92h5.26c-.23 1.45-1.43 4.25-5.26 4.25-3.16 0-5.73-2.6-5.73-5.8s2.57-5.8 5.73-5.8c1.8 0 3.01.77 3.7 1.43l2.53-2.45C17.04 3.6 15.1 2.6 12.5 2.6 7.59 2.6 3.77 6.39 3.77 11.1s3.82 8.5 8.73 8.5c5.04 0 8.37-3.54 8.37-8.5 0-.57-.06-1-.12-1.0z"
              fill="#EA4335" />
          </svg>
          Sign up with Google
        </button>
        <button class="facebook-btn social-btn" id="facebook-signup" title="Sign up with Facebook">
          <!-- Facebook SVG Icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
            style="vertical-align:middle;margin-right:8px;">
            <path
              d="M22 12.07C22 6.48 17.52 2 11.93 2S2 6.48 2 12.07c0 4.99 3.66 9.13 8.44 9.93v-7.03H8.06v-2.9h2.38V9.41c0-2.35 1.4-3.64 3.54-3.64 1.02 0 2.09.18 2.09.18v2.3h-1.18c-1.16 0-1.52.72-1.52 1.46v1.75h2.59l-.41 2.9h-2.18v7.03C18.34 21.2 22 17.06 22 12.07z"
              fill="#1877F2" />
          </svg>
          Sign up with Facebook
        </button>
      </div>

      <!-- Social account picker modal -->
      <div class="modal" id="socialAccountModal">
        <div class="modal-content">
          <span class="close" id="closeSocialModal">&times;</span>
          <h3 id="socialModalTitle">Choose an account</h3>
          <div id="socialAccountsList" style="margin-top:10px;display:flex;flex-direction:column;gap:8px;"></div>
          <div style="margin-top:12px;display:flex;gap:8px;align-items:center;">
            <input id="manualSocialEmail" type="email" placeholder="Enter email to use"
              style="flex:1;padding:8px;border:1px solid #ddd;border-radius:6px;">
            <button id="useManualSocial" class="interactive-btn">Use</button>
          </div>
        </div>
      </div>
      <div class="toggle-link" id="show-login-link">Already have an account? Login</div>
    </div>

    <!-- Login Form -->
    <div id="login-form" class="hidden">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="text" id="login-username" name="username" placeholder="Username" required>
        <input type="password" id="login-password" name="password" placeholder="Password" required>
        <button type="submit" id="login-btn">Login</button>
      </form>
      <div id="loginMessage"></div>
      <div class="social-buttons">
        <button class="google-btn" id="google-login">Login with Google</button>
        <button class="facebook-btn" id="facebook-login">Login with Facebook</button>
      </div>
      <div class="toggle-link" id="show-signup-link">New user? Sign Up</div>
    </div>

    <!-- Welcome Page -->
    <div id="welcome-page" class="hidden">
      <h2>Welcome üéâ</h2>
      <p id="welcome-msg"></p>
      <button id="logout-btn">Logout</button>
    </div>
  </div>

  <h1 class="text-3xl font-semibold text-center mx-auto">Our Latest Creations</h1>
  <p class="text-sm text-slate-500 text-center mt-2 max-w-lg mx-auto">A visual collection of our most recent works -
    each piece crafted with intention, emotion, and style.</p>

  <div id="galleryRow" class="flex items-center gap-6 h-[400px] w-full max-w-5xl mt-10 mx-auto">
    <div class="relative group flex-grow transition-all w-56 h-[400px] duration-500 hover:w-full">
      <img class="h-full w-full object-cover object-center"
        src="https://images.unsplash.com/photo-1543269865-0a740d43b90c?q=80&w=800&h=400&auto=format&fit=crop"
        alt="Prompt engineers collaborating">
      <div
        class="absolute inset-0 flex flex-col justify-end p-10 text-white bg-black/50 opacity-0 group-hover:opacity-100 transition-all duration-300">
        <h1 class="text-3xl">Prompt engineers</h1>
        <p class="text-sm">Bridging the gap between human intent and machine understanding through expert prompt design.
        </p>
      </div>
    </div>
    <div class="relative group flex-grow transition-all w-56 h-[400px] duration-500 hover:w-full">
      <img class="h-full w-full object-cover object-right"
        src="https://images.unsplash.com/photo-1714976326351-0ecf0244f0fc?q=80&w=800&h=400&auto=format&fit=crop"
        alt="Data scientists analyzing data">
      <div
        class="absolute inset-0 flex flex-col justify-end p-10 text-white bg-black/50 opacity-0 group-hover:opacity-100 transition-all duration-300">
        <h1 class="text-3xl">Data scientists</h1>
        <p class="text-sm">Bridging the gap between human intent and machine understanding through expert prompt design.
        </p>
      </div>
    </div>
    <div class="relative group flex-grow transition-all w-56 h-[400px] duration-500 hover:w-full">
      <img class="h-full w-full object-cover object-center"
        src="https://images.unsplash.com/photo-1736220690062-79e12ca75262?q=80&w=800&h=400&auto=format&fit=crop"
        alt="Software engineers coding">
      <div
        class="absolute inset-0 flex flex-col justify-end p-10 text-white bg-black/50 opacity-0 group-hover:opacity-100 transition-all duration-300">
        <h1 class="text-3xl">Software engineers</h1>
        <p class="text-sm">Bridging the gap between human intent and machine understanding through expert prompt design.
        </p>
      </div>
    </div>
  </div>

  <section class="inspired">
    <h2>Inspired Words</h2>
    <div class="inspired-words">
      <span class="interactive-word">Connect</span>
      <span class="interactive-word">Empower</span>
      <span class="interactive-word">Innovate</span>
      <span class="interactive-word">Share</span>
      <span class="interactive-word">Inspire</span>
    </div>
  </section>

  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-brand">
        <img src="logo.png" alt="P2P Chat" class="footer-logo">
        <p class="brand-desc">P2P Chat ‚Äî secure, fast, and private communication.</p>
      </div>

      <div class="footer-links">
        <h4>Company</h4>
        <ul>
          <li><a href="#">About</a></li>
          <li><a href="#">Careers</a></li>
          <li><a href="#">Blog</a></li>
        </ul>
      </div>

      <div class="footer-legal">
        <h4>Legal</h4>
        <ul>
          <li><a href="#">Terms of Service</a></li>
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Cookies</a></li>
        </ul>
      </div>

      <div class="footer-contact">
        <h4>Contact</h4>
        <p>Email: <a href="mailto:support@p2pchat.example">support@p2pchat.example</a></p>
        <p>Phone: <a href="tel:+1234567890">+1 (234) 567-890</a></p>
        <div class="social-icons">
          <a href="#" aria-label="Twitter"><img src="twitter-icon.png" alt="Twitter" class="social-icon"></a>
          <a href="#" aria-label="Facebook"><img src="facebook-icon.png" alt="Facebook" class="social-icon"></a>
          <a href="#" aria-label="LinkedIn"><img src="linkedin-icon.png" alt="LinkedIn" class="social-icon"></a>
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <small>&copy; 2025 P2P Chat. All rights reserved.</small>
    </div>
  </footer>
  <script>
    // API configuration
    //const API_BASE = 'http://localhost:5000/api';
    
    // API configuration through NGINX Load Balancer
    const API_BASE = 'http://192.168.137.109/api';  // LB IP
   


    // DOM Elements
    const signupForm = document.getElementById('signupForm');
    const mainSignupForm = document.getElementById('mainSignupForm');
    const loginForm = document.getElementById('loginForm');
    const signupModal = document.getElementById('signupModal');
    const closeModal = document.getElementById('closeModal');
    const signupHeroBtn = document.getElementById('signupHeroBtn');
    const showLoginLink = document.getElementById('show-login-link');
    const showSignupLink = document.getElementById('show-signup-link');
    const signupFormDiv = document.getElementById('signup-form');
    const loginFormDiv = document.getElementById('login-form');
    const welcomePage = document.getElementById('welcome-page');
    const logoutBtn = document.getElementById('logout-btn');
    const logoutLink = document.getElementById('logoutLink');

    // Modal functionality
    signupHeroBtn.addEventListener('click', () => {
      signupModal.style.display = 'block';
    });

    closeModal.addEventListener('click', () => {
      signupModal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
      if (e.target === signupModal) {
        signupModal.style.display = 'none';
      }
    });

    // Form toggle functionality
    showLoginLink.addEventListener('click', (e) => {
      e.preventDefault();
      signupFormDiv.classList.add('hidden');
      loginFormDiv.classList.remove('hidden');
    });

    showSignupLink.addEventListener('click', (e) => {
      e.preventDefault();
      loginFormDiv.classList.add('hidden');
      signupFormDiv.classList.remove('hidden');
    });

    // Signup functionality
    async function handleSignup(formData, messageElement) {
      try {
        console.log('üîÅ Sending signup request', formData);
        const response = await fetch(`${API_BASE}/signup`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        console.log('üì• Raw response', response);

        let data = null;
        try {
          data = await response.json();
        } catch (jsonErr) {
          console.error('‚ö†Ô∏è Failed to parse JSON from signup response', jsonErr);
          showMessage(messageElement, `Server returned invalid response (status ${response.status})`, 'error');
          return;
        }

        console.log('üì¶ Signup response JSON', data);

        // Prefer explicit success flag when available, otherwise treat 2xx as success
        const ok = (typeof data.success !== 'undefined') ? data.success : response.ok;

        if (ok) {
          showMessage(messageElement, data.message || 'Registration successful', 'success');
          setTimeout(() => {
            signupFormDiv.classList.add('hidden');
            loginFormDiv.classList.remove('hidden');
            if (signupModal) signupModal.style.display = 'none';
          }, 1500);
        } else {
          const msg = data && data.message ? data.message : `Signup failed (status ${response.status})`;
          showMessage(messageElement, msg, 'error');
        }
      } catch (error) {
        console.error('‚õî Network or JS error during signup', error);
        showMessage(messageElement, 'Network error. Please try again.', 'error');
      }
    }

    // Login functionality
    async function handleLogin(formData) {
      try {
        const response = await fetch(`${API_BASE}/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        const data = await response.json();
        const messageElement = document.getElementById('loginMessage');

        if (data.success) {
          showMessage(messageElement, data.message, 'success');

          // Store COMPLETE user data for stp.html
          const userData = {
            id: data.user.id,
            username: data.user.username,
            email: data.user.email,
            user_id: data.user.id, // For compatibility with stp.html
            profile_data: data.user.profile_data || {
              avatar: `https://i.pravatar.cc/150?u=${data.user.username}`
            }
          };

          sessionStorage.setItem('currentUser', JSON.stringify(userData));
          sessionStorage.setItem('isLoggedIn', 'true');
          sessionStorage.setItem('loginTime', new Date().toISOString());

          console.log('‚úÖ Login successful, user data stored:', userData);

          // Update nav so auth-only links become visible immediately
          const topNav = document.querySelector('.top-nav');
          if (topNav) topNav.classList.add('auth-visible');

          // Redirect immediately to tp.html (chat interface)
          try {
            window.location.replace('tp.html');
          } catch (e) {
            window.location.href = 'tp.html';
          }

        } else {
          showMessage(messageElement, data.message, 'error');
        }
      } catch (error) {
        const messageElement = document.getElementById('loginMessage');
        showMessage(messageElement, 'Network error. Please try again.', 'error');
      }
    }

    // Utility function to show messages
    function showMessage(element, message, type) {
      element.innerHTML = `<div class="${type}-message">${message}</div>`;
      setTimeout(() => {
        element.innerHTML = '';
      }, 5000);
    }

    // Event listeners for forms
    // Password strength helpers
    function checkPasswordCriteria(pw) {
      const res = {
        length: pw.length >= 8,
        upper: /[A-Z]/.test(pw),
        lower: /[a-z]/.test(pw),
        digit: /[0-9]/.test(pw),
        letter: /[A-Za-z]/.test(pw)
      };
      res.strong = res.length && res.upper && res.lower && res.digit && res.letter;
      return res;
    }

    function renderPasswordHelp(containerEl, pw) {
      if (!containerEl) return;
      const c = checkPasswordCriteria(pw || '');
      const make = (ok, txt) => `<div style="display:flex;align-items:center;gap:8px;color:${ok ? '#14833b' : '#b02a2a'}"><span style="font-weight:700">${ok ? '‚úì' : '‚úï'}</span><span>${txt}</span></div>`;
      containerEl.style.display = 'block';
      containerEl.innerHTML = `
    ${make(c.length, 'At least 8 characters')}
    ${make(c.upper, 'One uppercase letter (A-Z)')}
    ${make(c.lower, 'One lowercase letter (a-z)')}
    ${make(c.digit, 'At least one number (0-9)')}
  `;
    }

    // Wire live feedback for both password inputs
    const modalPwInput = document.querySelector('#signupForm input[name="password"]');
    const modalPwHelp = document.getElementById('modalSignupPasswordHelp');
    const modalSubmitBtn = document.querySelector('#signupForm .signup-btn');
    if (modalPwInput) {
      modalPwInput.addEventListener('input', (e) => {
        renderPasswordHelp(modalPwHelp, e.target.value);
        if (modalSubmitBtn) modalSubmitBtn.disabled = !checkPasswordCriteria(e.target.value).strong;
      });
    }

    const mainPwInput = document.getElementById('signup-password');
    const mainPwHelp = document.getElementById('mainSignupPasswordHelp');
    const mainSubmitBtn = document.getElementById('signup-btn');
    if (mainPwInput) {
      mainPwInput.addEventListener('input', (e) => {
        renderPasswordHelp(mainPwHelp, e.target.value);
        if (mainSubmitBtn) mainSubmitBtn.disabled = !checkPasswordCriteria(e.target.value).strong;
      });
    }

    // Submit handlers with strength check
    if (signupForm) {
      signupForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const pw = signupForm.password.value || '';
        if (!checkPasswordCriteria(pw).strong) {
          renderPasswordHelp(modalPwHelp, pw);
          showMessage(document.getElementById('signupMessage'), 'Password is not strong enough. Please follow the requirements.', 'error');
          return;
        }
        const formData = {
          username: signupForm.username.value,
          email: signupForm.email.value,
          password: pw
        };
        handleSignup(formData, document.getElementById('signupMessage'));
      });
    }

    if (mainSignupForm) {
      mainSignupForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const pw = document.getElementById('signup-password').value || '';
        if (!checkPasswordCriteria(pw).strong) {
          renderPasswordHelp(mainPwHelp, pw);
          showMessage(document.getElementById('mainSignupMessage'), 'Password is not strong enough. Please follow the requirements.', 'error');
          return;
        }
        const formData = {
          username: document.getElementById('signup-username').value,
          email: document.getElementById('signup-email').value,
          password: pw
        };
        handleSignup(formData, document.getElementById('mainSignupMessage'));
      });
    }

    if (loginForm) {
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = {
          username: document.getElementById('login-username').value,
          password: document.getElementById('login-password').value
        };
        handleLogin(formData);
      });
    }

    // Logout functionality
    function handleLogout() {
      // Clear client-side session
      sessionStorage.removeItem('currentUser');
      sessionStorage.removeItem('isLoggedIn');
      sessionStorage.removeItem('loginTime');

      // Update nav visibility
      const topNav = document.querySelector('.top-nav');
      if (topNav) topNav.classList.remove('auth-visible');

      // Attempt to clear server-side session (best-effort)
      try {
        fetch('http://10.145.81.112:5000/logout', { method: 'GET', credentials: 'include' });

        //fetch('/logout', { method: 'GET', credentials: 'include' });
      } catch (e) {
        // ignore
      }

      window.location.href = 'index.html';
    }

    if (logoutBtn) {
      logoutBtn.addEventListener('click', handleLogout);
    }

    if (logoutLink) {
      logoutLink.addEventListener('click', (e) => {
        e.preventDefault();
        handleLogout();
      });
    }

    // Social account picker: attempt to show available federated/password credentials
    const socialModal = document.getElementById('socialAccountModal');
    const socialList = document.getElementById('socialAccountsList');
    const socialTitle = document.getElementById('socialModalTitle');
    const closeSocialModal = document.getElementById('closeSocialModal');
    const manualSocialEmail = document.getElementById('manualSocialEmail');
    const useManualSocial = document.getElementById('useManualSocial');

    closeSocialModal.addEventListener('click', () => { socialModal.style.display = 'none'; });
    window.addEventListener('click', (e) => { if (e.target === socialModal) socialModal.style.display = 'none'; });

    async function openSocialPicker(provider) {
      socialTitle.textContent = provider === 'google' ? 'Choose Google account' : 'Choose Facebook account';
      socialList.innerHTML = '';

      // Try Credential Management API to fetch federated or password credentials (best-effort)
      let found = [];
      try {
        if (navigator.credentials && navigator.credentials.get) {
          // Try federated (may not be supported)
          try {
            const cred = await navigator.credentials.get({ federated: { providers: provider === 'google' ? ['https://accounts.google.com'] : ['https://www.facebook.com'] }, mediation: 'optional' });
            if (cred && cred.id) found.push({ id: cred.id, type: 'federated' });
          } catch (ferr) {
            // ignore
          }

          // Try stored password credential (if user saved login)
          try {
            const pcred = await navigator.credentials.get({ password: true, mediation: 'optional' });
            if (pcred && pcred.id) found.push({ id: pcred.id, type: 'password' });
          } catch (perr) {
            // ignore
          }
        }
      } catch (err) {
        console.warn('Credential API not available or failed', err);
      }

      // Also include any accounts stored in localStorage under 'social_accounts'
      try {
        const saved = JSON.parse(localStorage.getItem('social_accounts') || '[]');
        saved.forEach(s => { if (s.provider === provider) found.push({ id: s.email, type: s.type || 'stored' }); });
      } catch (err) { }

      // Remove duplicates
      const uniq = [];
      found.forEach(f => { if (!uniq.find(u => u.id === f.id)) uniq.push(f); });

      if (uniq.length === 0) {
        const note = document.createElement('div');
        note.textContent = 'No saved accounts found. You can enter an email below to use.';
        socialList.appendChild(note);
      } else {
        uniq.forEach(acc => {
          const btn = document.createElement('button');
          btn.className = 'interactive-btn';
          btn.style.padding = '8px';
          btn.style.textAlign = 'left';
          btn.style.border = '1px solid #eee';
          btn.style.borderRadius = '8px';
          btn.textContent = acc.id + (acc.type ? ` (${acc.type})` : '');
          btn.addEventListener('click', () => {
            // Fill the main signup/login email with chosen account and close
            const signupEmail = document.getElementById('signup-email') || document.getElementById('signup-email');
            if (signupEmail) signupEmail.value = acc.id;
            socialModal.style.display = 'none';
          });
          socialList.appendChild(btn);
        });
      }

      // show modal
      socialModal.style.display = 'block';
    }

    // Wire social buttons
    const gBtn = document.getElementById('google-signup');
    const fbBtn = document.getElementById('facebook-signup');
    if (gBtn) gBtn.addEventListener('click', (e) => { e.preventDefault(); openSocialPicker('google'); });
    if (fbBtn) fbBtn.addEventListener('click', (e) => { e.preventDefault(); openSocialPicker('facebook'); });

    // Use manual social email
    if (useManualSocial) useManualSocial.addEventListener('click', () => {
      const val = manualSocialEmail.value && manualSocialEmail.value.trim();
      if (!val) return alert('Enter an email');
      const se = document.getElementById('signup-email');
      if (se) se.value = val;
      // Persist selection to localStorage for next time
      try {
        const store = JSON.parse(localStorage.getItem('social_accounts') || '[]');
        store.push({ provider: 'google', email: val, type: 'manual' });
        localStorage.setItem('social_accounts', JSON.stringify(store));
      } catch (err) { }
      socialModal.style.display = 'none';
    });

    // Check if user is already logged in
    function checkAuthStatus() {
      const currentUser = sessionStorage.getItem('currentUser');
      if (currentUser && welcomePage) {
        const user = JSON.parse(currentUser);
        document.getElementById('welcome-msg').textContent = `Welcome back, ${user.username}!`;
        signupFormDiv.classList.add('hidden');
        loginFormDiv.classList.add('hidden');
        welcomePage.classList.remove('hidden');
      }
      // Update nav visibility for authenticated users
      const topNav = document.querySelector('.top-nav');
      if (sessionStorage.getItem('isLoggedIn') === 'true') {
        if (topNav) topNav.classList.add('auth-visible');
      } else {
        if (topNav) topNav.classList.remove('auth-visible');
      }
    }

    // Initialize auth check
    checkAuthStatus();

    // Promo card interactions
    const promoCards = document.querySelectorAll('.interactive-card');
    const promoModal = document.getElementById('promoModal');
    const closePromo = document.getElementById('closePromo');
    const promoTitle = document.getElementById('promoTitle');
    const promoDesc = document.getElementById('promoDesc');

    promoCards.forEach(card => {
      card.addEventListener('click', () => {
        const title = card.getAttribute('data-title') || card.querySelector('h3').textContent;
        const desc = card.getAttribute('data-desc') || card.querySelector('p').textContent;

        promoTitle.textContent = title;
        promoDesc.textContent = desc;
        promoModal.style.display = 'block';
      });
    });

    closePromo.addEventListener('click', () => {
      promoModal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
      if (e.target === promoModal) {
        promoModal.style.display = 'none';
      }
    });

    // Interactive words animation
    const interactiveWords = document.querySelectorAll('.interactive-word');
    interactiveWords.forEach(word => {
      word.addEventListener('mouseover', () => {
        word.style.transform = 'scale(1.2) translateY(-5px)';
        word.style.color = '#4F46E5';
      });

      word.addEventListener('mouseout', () => {
        word.style.transform = 'scale(1) translateY(0)';
        word.style.color = '';
      });
    });

    // Gallery hover effects
    const galleryItems = document.querySelectorAll('#galleryRow > div');
    galleryItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        galleryItems.forEach(other => {
          if (other !== item) {
            other.style.width = '80px';
          }
        });
      });

      item.addEventListener('mouseleave', () => {
        galleryItems.forEach(other => {
          other.style.width = '14rem';
        });
      });
    });
    // Apply home/index background color selected in Settings
    function applyHomeBgColor() {
      try {
        const c = localStorage.getItem('home_bg_color');
        if (c) {
          document.body.style.backgroundColor = c;
        }
      } catch (e) {
        // ignore
      }
    }

    window.addEventListener('storage', (e) => {
      if (!e.key) return;
      if (e.key === 'home_bg_color' || e.key === 'themeUpdated') {
        applyHomeBgColor();
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      applyHomeBgColor();
    });
  </script>
</body>

</html>